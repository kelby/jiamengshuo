<% set_meta_tags :title => "话题讨论" %>

<style type="text/css">
  .post-count-spacing>li:first-child {
    width: 105px;
  }

  .post-count-spacing>li:last-child {
    width: 80% !important;
    padding-left: 0.9375em;
  }

  ul.toolbar > li {
    display: inline;
  }
</style>

<div class="row posts">
  <div class="large-9 small-12 columns">
    <ul>
      <% @topics.each do |topic| %>
        <div class="row post impressions new">
          <div class="small-12 columns">
            <ul class="post-count-spacing small-block-grid-2 large-block-grid-2">
              <li>
              <div class="post-count new-general with-replies">
                <%= link_to topic.user do %>
                  <div class="post-count-container new-general with-replies">
                    <%= image_tag topic.user.avatar_url(:tiny), class: 'tiny_avatar' %>
                  </div>
                <% end %>
                <div class="total-post-count new total-replies">
                  <%= topic.comments.count %> 回复
                </div>
              </div>
              </li>
              <li>
              <div class="post-description">
                <h4 class="content-title">
                  <% case topic.catalog_id %>
                  <% when 1000 %>
                    <%= label_tag :catalog, "拜师", class: "blue google button", style: "display: inline-block;" %>
                  <% when 1001 %>
                    <%= label_tag :catalog, "收徒", class: "red google button", style: "display: inline-block;" %>
                  <% when 1002 %>
                    <%= label_tag :catalog, "拜师兼收徒", class: "green google button", style: "display: inline-block;" %>
                  <% else %>
                    <%= label_tag :catalog, "其它", class: "purple google button", style: "display: inline-block;" %>
                  <% end %>

                  <%= link_to topic do %>
                    <%= topic.title %>
                  <% end %>
                </h4>
                <p class="author-name">
                By <span class="author">
                  <%= link_to topic.user do %><%= topic.user.username %><% end %>
                </span><span class="by">, last Reply by</span>
                <span class="when">
                  <span class="author">
                    <%= link_to topic.comments.last.try(:user) do %>
                      <%= topic.comments.last.try(:user).try(:username) %>
                    <% end %>
                  </span>
                  <%= time_ago_in_words topic.created_at %> 前
                </span>
                </p>
                <div class="post-description copy">

                  <p class="tags">
                  标签：
                    <% topic.tags.each do |tag| %>
                      <%= link_to tag.name, "javascript:void(0);", class: "tag-container" %>
                    <% end %>
                  </p>
                </div>
              </div>
              </li>
            </ul>
            <hr>
          </div>
        </div>
      <% end %>
    </ul>

    <%= paginate @topics %>
  </div>

  <div class="large-3 columns">
    <div>
      <h5>新建帖子，并选择类型：</h5>

      <%= link_to new_topic_path(catalog_id: 1000), class: "blue google button" do %>
        <%= content_tag(:strong, '拜师!') %>
      <% end %>
      <br>

      <%= link_to new_topic_path(catalog_id: 1001), class: "orange google button" do %>
        <%= content_tag(:strong, '收徒!') %>
      <% end %>
      <br>

      <%= link_to new_topic_path(catalog_id: 1002), class: "green google button" do %>
        <%= content_tag(:strong, '拜师兼收徒!') %>
      <% end %>
      <br>

      <%= link_to new_topic_path(catalog_id: 1003), class: "purple google button" do %>
        <%= content_tag(:strong, '其它!') %>
      <% end %>
    </div>

    <hr class="dashed"></hr>

    <div class="install-foundation">
      <h5>推荐关注!</h5>
      <% unless @users.blank? %>
        <% @users.each do |user| %>
          <p>
          <%= link_to user do %><%= image_tag user.avatar_url(:mini), class: "mini_avatar" %><% end %>
          <strong><%= link_to user do %><%= user.username %><% end %></strong>
          <br>
          <%= user.info %>
          </p>
          <hr class="dashed"></hr>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
