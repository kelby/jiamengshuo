<% set_meta_tags :title => "话题讨论" %>

<style type="text/css">
  .post-count-spacing>li:first-child {
    width: 105px;
  }

  .post-count-spacing>li:last-child {
    width: 80% !important;
    padding-left: 0.9375em;
  }

  ul.toolbar > li {
    display: inline;
  }
</style>

<div class="row posts">
  <div class="large-9 small-12 columns">
    <ul>
      <% @topics.each do |topic| %>
        <div class="row post impressions new">
          <div class="small-12 columns">
            <ul class="post-count-spacing small-block-grid-2 large-block-grid-2">
              <li>
                <div class="post-count new-general with-replies">
                  <%= link_to topic.user do %>
                    <div class="post-count-container new-general with-replies">
                      <%= image_tag topic.user.avatar_url(:tiny), class: 'tiny_avatar' %>
                    </div>
                  <% end %>
                  <div class="total-post-count new total-replies">
                    <%= topic.comments.count %> 评论
                  </div>
                </div>
              </li>

              <li>
                <div class="post-description">
                  <h4 class="content-title">
                    <% case topic.category %>
                    <% when "bai_shi" %>
                      <%= link_to "拜师", topics_bai_shi_path, class: "blue google button", style: "display: inline-block;" %>
                    <% when "shou_tu" %>
                      <%= link_to "收徒", topics_shou_tu_path, class: "yellow google button", style: "display: inline-block;" %>
                    <% when "bai_shi_he_shou_tu" %>
                      <%= link_to "拜师兼收徒", topics_bai_shi_he_shou_tu_path, class: "green google button", style: "display: inline-block;" %>
                    <% else %>
                      <%= link_to "其它", topics_qi_ta_path, class: "purple google button", style: "display: inline-block;" %>
                    <% end %>

                    <%= link_to topic do %>
                      <%= topic.title %>
                    <% end %>
                  </h4>
                  <p class="author-name">
                  <span class="author">
                    <%= link_to topic.user do %><%= topic.user.username %><% end %>
                    创建于 <%= time_ago_in_words topic.created_at %> 前
                  </span>
                  <% if topic.comments.any? %>
                  <!-- <span class="by">, last Reply by</span> -->
                  <span class="when">
                    <span class="author">
                      ，最后由
                      <%= link_to topic.comments.last.try(:user) do %>
                        <%= topic.comments.last.try(:user).try(:username) %>
                      <% end %>
                    </span>
                    评论于 <%= time_ago_in_words topic.created_at %> 前
                  </span>
                  <% end %>
                  </p>
                  <div class="post-description copy">

                    <p class="tags">
                    标签：
                      <% topic.tags.each do |tag| %>
                        <%= link_to tag.name, "javascript:void(0);", class: "tag-container" %>
                      <% end %>
                    </p>
                  </div>
                </div>
              </li>
            </ul>
            <hr>
          </div>
        </div>
      <% end %>
    </ul>

    <%= paginate @topics %>
  </div>

  <div class="large-3 columns">
    <div>
      <h5>新建帖子，并选择类型：</h5>
      <%= render 'select_category' %>
    </div>

    <hr class="dashed"></hr>

    <div class="install-foundation">
      <h5>推荐关注!</h5>
      <% unless @users.blank? %>
        <% @users.each do |user| %>
          <p>
          <%= link_to user do %><%= image_tag user.avatar_url(:mini), class: "mini_avatar" %><% end %>
          <strong><%= link_to user do %><%= user.username %><% end %></strong>
          <br>
          <%= user.info %>
          </p>
          <hr class="dashed"></hr>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
